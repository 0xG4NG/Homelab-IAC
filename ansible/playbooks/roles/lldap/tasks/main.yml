---
- name: Install required packages
  ansible.builtin.package:
    name:
      - sssd
      - sssd-client
      - sssd-tools
      - oddjob-mkhomedir
      - authconfig
    state: present

- name: Configure LDAP authentication
  ansible.builtin.shell: >
    authconfig
    --enableldap
    --enableldapauth
    --ldapserver {{ ldap_server }}
    --ldapbasedn {{ ldap_basedn }}
    --enablemkhomedir
    --update
  args:
    warn: false
    creates: /etc/sssd/sssd.conf
  notify: restart sssd

- name: Check user g4ng from LDAP
  ansible.builtin.command: id g4ng
  register: lldap_g4ng_info
  ignore_errors: true
  changed_when: false

- name: Display g4ng info
  ansible.builtin.debug:
    msg: "{{ g4ng_info.stdout }}"
